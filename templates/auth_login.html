<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Login — VFXKart</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">
  <style>
    /* background blobs */
    .bg-blobs{position:fixed;inset:0;pointer-events:none;z-index:-1;overflow:hidden}
    .blob{position:absolute;filter:blur(60px);opacity:0.55;mix-blend:screen;border-radius:9999px;
      animation: float 12s ease-in-out infinite}
    .blob.a{width:380px;height:380px;background:var(--accent1);top:-80px;left:-60px}
    .blob.b{width:420px;height:420px;background:var(--accent2);bottom:-120px;right:-60px;animation-delay:2s}
    .blob.c{width:280px;height:280px;background:#7cf5ff33;top:40%;left:60%;animation-delay:4s}

    @keyframes float {
      0%,100%{transform:translateY(0) translateX(0)}
      50%{transform:translateY(-16px) translateX(8px)}
    }

    .auth-wrap{max-width:420px;margin:60px auto}
    .tabs{display:flex;gap:8px;margin-bottom:14px}
    .tab{flex:1;text-align:center;padding:10px;border-radius:12px;
      border:1px solid rgba(255,255,255,0.06);cursor:pointer;
      user-select:none;transition:.25s}
    .tab.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#071026;border:none;transform:translateY(-1px)}
    .panel{transition:opacity .25s, transform .25s}
    .panel.hide{opacity:0;transform:translateY(6px);height:0;overflow:hidden}

    /* floating labels */
    .field{position:relative}
    .field input{width:100%;padding:14px 12px 12px;border-radius:10px;background:transparent;
      border:1px solid rgba(255,255,255,0.08);color:inherit;outline:none;transition:.2s}
    .field label{position:absolute;left:12px;top:12px;font-size:13px;color:var(--muted);
      transition:.2s;pointer-events:none}
    .field input:focus{border-color:rgba(255,255,255,0.25);box-shadow:0 0 0 6px rgba(255,255,255,0.035)}
    .field input:not(:placeholder-shown) + label,
    .field input:focus + label{top:-8px;left:10px;padding:0 6px;font-size:11px;background:#0c1420;border-radius:6px;color:#cfe7ff}

    .actions{display:flex;gap:8px;align-items:center}
    .btn.wide{width:100%}

    /* button micro interaction */
    .btn:active{transform:translateY(1px) scale(.995)}

    /* shake errors a bit */
    .flash.error{animation:shake .28s linear}
    @keyframes shake{
      0%,100%{transform:translateX(0)}
      20%{transform:translateX(-6px)}
      40%{transform:translateX(6px)}
      60%{transform:translateX(-4px)}
      80%{transform:translateX(4px)}
    }
  </style>
</head>
<body>
  <div class="bg-blobs">
    <div class="blob a"></div>
    <div class="blob b"></div>
    <div class="blob c"></div>
  </div>

  <div class="container auth-wrap">
    <div class="card">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <div class="logo">VK</div>
        <div>
          <div style="font-weight:700">VFXKart</div>
          <div class="note">Welcome back</div>
        </div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endwith %}

      <div class="tabs">
        <div id="tab-pass" class="tab">Password</div>
        <div id="tab-otp" class="tab">OTP</div>
      </div>

      <!-- PASSWORD PANEL -->
      <div id="panel-pass" class="panel">
        <form method="post" action="{{ url_for('auth_login') }}" style="display:grid;gap:12px">
          <div class="field">
            <input name="username" placeholder=" " required>
            <label>Username or email</label>
          </div>
          <div class="field">
            <input id="pw" name="password" type="password" placeholder=" " required>
            <label>Password</label>
          </div>
          <label style="display:flex;gap:8px;align-items:center;color:var(--muted);font-size:13px">
            <input type="checkbox" name="remember"> Remember me
          </label>
          <button class="btn wide" type="submit">Log in</button>
          <div class="actions" style="justify-content:space-between">
            <a class="btn ghost" href="{{ url_for('auth_register') }}">Create account</a>
            <a class="btn ghost" href="{{ url_for('auth_forgot') }}">Forgot?</a>
          </div>
        </form>
      </div>

      <!-- OTP PANEL -->
      <div id="panel-otp" class="panel hide">
        <form method="post" action="{{ url_for('auth_request_otp') }}" style="display:grid;gap:12px;margin-bottom:8px">
          <div class="field">
            <input name="username" placeholder=" " required>
            <label>Username or email</label>
          </div>
          <button class="btn wide" type="submit" id="sendBtn">Send code</button>
          <div class="note">We’ll email a 6-digit code. (Dev: code prints in server console.)</div>
        </form>
        <form method="post" action="{{ url_for('auth_verify_otp') }}" style="display:grid;gap:12px">
          <div class="field">
            <input name="username" placeholder=" " required>
            <label>Username or email</label>
          </div>
          <div class="field">
            <input name="otp" placeholder=" " maxlength="6" required>
            <label>6-digit code</label>
          </div>
          <button class="btn wide" type="submit">Verify & Log in</button>
        </form>
      </div>
    </div>
    <div class="footer">© 2025 VFXKart</div>
  </div>

<script>
(function(){
  const tabPass = document.getElementById('tab-pass');
  const tabOtp  = document.getElementById('tab-otp');
  const panelPass = document.getElementById('panel-pass');
  const panelOtp  = document.getElementById('panel-otp');

  function setMode(mode){
    const otp = mode==='otp';
    tabPass.classList.toggle('active', !otp);
    tabOtp.classList.toggle('active', otp);
    panelPass.classList.toggle('hide', otp);
    panelOtp.classList.toggle('hide', !otp);
    const url=new URL(window.location);
    url.searchParams.set('mode', otp?'otp':'password');
    history.replaceState({},'',url);
  }

  tabPass.addEventListener('click', ()=> setMode('password'));
  tabOtp .addEventListener('click', ()=> setMode('otp'));

  // initial mode from ?mode=otp
  const params = new URLSearchParams(window.location.search);
  setMode(params.get('mode')==='otp' ? 'otp' : 'password');

  // simple cooldown on send btn
  const sendBtn = document.getElementById('sendBtn');
  if(sendBtn){
    sendBtn.addEventListener('click', ()=>{
      setTimeout(()=>{
        let t=30;
        const iv=setInterval(()=>{
          if(t<=0){sendBtn.disabled=false;sendBtn.textContent='Send code';clearInterval(iv)}
          else {sendBtn.disabled=true;sendBtn.textContent='Resend ('+t+'s)'; t--}
        },1000);
      },100); // start after form posts, for UX
    });
  }
})();
</script>
</body>
</html>
