{% extends "_base.html" %}
{% block title %}Shop — VFXKart{% endblock %}
{% block content %}
<h2>Shop</h2>

<form class="filters" method="get">
  <input name="q" placeholder="Search products" value="{{ query_args.q }}">
  <select name="seller">
    <option value="">All sellers</option>
    {% for s in sellers %}
      <option value="{{ s }}" {% if query_args.seller==s %}selected{% endif %}>{{ s }}</option>
    {% endfor %}
  </select>
  <input name="min_price" type="number" step="0.01" placeholder="Min price" value="{{ query_args.min_price }}">
  <input name="max_price" type="number" step="0.01" placeholder="Max price" value="{{ query_args.max_price }}">
  <select name="sort">
    <option value="newest" {% if query_args.sort=='newest' %}selected{% endif %}>Newest</option>
    <option value="price_asc" {% if query_args.sort=='price_asc' %}selected{% endif %}>Price ↑</option>
    <option value="price_desc" {% if query_args.sort=='price_desc' %}selected{% endif %}>Price ↓</option>
  </select>
  <button class="btn">Apply</button>
  <a class="btn ghost" href="{{ url_for('shop') }}">Reset</a>
</form>

<p class="muted">Showing {{ products|length }} of {{ total }} result{{ total!=1 and 's' or '' }}.</p>

<div class="grid">
  {% for p in products %}
  <div class="card">
    {% if p.image %}
      <img src="{{ p.image }}" alt="{{ p.title }}">
    {% else %}
      <div class="img ph">No image</div>
    {% endif %}
    <h3>{{ p.title }}</h3>
    <div class="muted">Seller: {{ p.seller }}</div>
    <div class="price">{{ p.price or '—' }}</div>
    <p><a class="link" href="{{ url_for('product_detail', product_id=p.id) }}">View</a></p>
    <form method="post" action="{{ url_for('cart_add') }}">
      <input type="hidden" name="product_id" value="{{ p.id }}">
      <button class="btn small">Add to cart</button>
    </form>
  </div>
  {% endfor %}
</div>

{% if total_pages>1 %}
<div class="pagination">
  {% for i in range(1, total_pages+1) %}
    <a
      class="page {% if i==page %}active{% endif %}"
      href="{{ url_for(
              'shop',
              q=query_args.q,
              seller=query_args.seller,
              min_price=query_args.min_price,
              max_price=query_args.max_price,
              sort=query_args.sort,
              per_page=query_args.per_page,
              page=i
            ) }}"
    >{{ i }}</a>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
